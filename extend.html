<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js">
<!--<![endif]-->

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>How to Build Mimosa Modules - Mimosa</title>
  <meta name="description" content="Mimosa is extensible, making it easy to add your own functionality via modules.">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- <link rel="stylesheet" href="css/main.css"> -->
  <link rel="stylesheet" href="css/bootstrap.min.css">
  <link rel="stylesheet" href="css/bootstrap-responsive.min.css">
  <link rel="stylesheet" href="css/app.css">

  <link rel="shortcut icon" href="img/favicon.ico">
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="img/apple-touch-icon-144-precomposed.png">
  <link rel="apple-touch-icon-precomposed" sizes="114x114" href="img/apple-touch-icon-114-precomposed.png">
  <link rel="apple-touch-icon-precomposed" sizes="72x72" href="img/apple-touch-icon-72-precomposed.png">
  <link rel="apple-touch-icon-precomposed" href="img/apple-touch-icon-57-precomposed.png">
</head>

<body data-spy="scroll" data-target=".subnav" data-offset="50">

  <div class="navbar navbar-fixed-top">
    <div class="navbar-inner">
      <div class="container">
        <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <div class="nav-collapse collapse">
          <ul class="nav">
            <li class="">
              <a href="./index.html">Mimosa</a>
            </li>
            <li class="">
              <a href="./started.html">Get Started</a>
            </li>
            <li class="">
              <a href="./commands.html">Commands</a>
            </li>
            <li class="">
              <a href="./modules.html">Modules</a>
            </li>
            <li class="active">
              <a href="./extend.html">Extend</a>
            </li>
            <li class="">
              <a href="./configuration.html">Config</a>
            </li>
            <li class="">
              <a href="./about.html">About/FAQ</a>
            </li>
            <li class="">
              <a href="http://dbashford.github.io">Blog</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <div class="container main">

    <header class="jumbotron subhead" id="overview">
      <h1>Build Your Own Mimosa Module</h1>
    </header>

    <section class="command-list server-list">
      <div class="page-header" id="create">
        <h1>
          Create Your Own Module: Summarized
          <small><span class="options">getting off the ground</span></small>
        </h1>
      </div>

      <p>The following is a quick tutorial on how to build a simple module. You could also visit this <a href="http://dbashford.github.io/making-a-mimosa-module/index.html">post on the blog</a> which covers the same topic.</p>

      <p>The best way to figure out how to create a module is to look at an existing one. The <a href="https://github.com/dbashford/mimosa-minify-html">mimosa-minify-html</a> module is a simple module to understand: it exists to minify HTML files, making them as small as possible without removing capability or content.</p>

      <p>At the bottom of the <a href="https://github.com/dbashford/mimosa-minify-html/blob/3589ae3113286cdb7243107ba4c4a62dffa93db1/src/index.js#L36-L41">index file</a> is the <code class="option">module.exports</code> object. That object defines the module interface.</p>

      <p>Working from the bottom up:</p>

      <div class="row">
        <div class="span8">
          <ul>
            <li><code class="option">validate</code> is optional, but if it exists it is called to validate a user's configuration. The <a href="https://github.com/dbashford/mimosa-minify-html/blob/3589ae3113286cdb7243107ba4c4a62dffa93db1/src/config.js#L18-L25">mimosa-minify-html validate</a> is small. One thing it does is verify that the mimosa-config's <code class="option">minifyHtml</code> object is an <code class="option">object</code>. If it wasn't <code class="option">validate</code> would return an error, Mimosa would not start, and the error message would be displayed.</li>
            <li><code class="option">placeholder</code>, also optional, is how the commented out mimosa-config placeholder text is provided and how the <code class="option">mimosa mod:config</code> command is able to output a module's configuration snippet. <a href="https://github.com/dbashford/mimosa-minify-html/blob/3589ae3113286cdb7243107ba4c4a62dffa93db1/src/config.js#L11-L16">mimosa-minify-html's placeholder</a> contains text explaining each configuration parameter.</li>
            <li><code class="option">defaults</code>, again optional, is how the module lets Mimosa know its default configuration. <a href="https://github.com/dbashford/mimosa-minify-html/blob/3589ae3113286cdb7243107ba4c4a62dffa93db1/src/config.js#L3-L9">mimosa-minify-html's defaults</a> returns a simple object.</li>
            <li><code class="option">registration</code> is how a module informs Mimosa what code to call and when.</li>
          </ul>
        </div>
        <div class="span4">
          <pre>module.exports = {
  registration: registration,
  defaults: config.defaults,
  placeholder: config.placeholder,
  validate: config.validate
}</pre>
        </div>
      </div>
      <p>Lets break down a single line of <a href="https://github.com/dbashford/mimosa-minify-html/blob/3589ae3113286cdb7243107ba4c4a62dffa93db1/src/index.js#L32">mimosa-minify-html's registration</a>.</p>

        <div class="row">
          <div class="span8">

            <ul>
              <li><code class="option">register</code> is a function provided by Mimosa to execute the registration.</li>
              <li>The entries in the <code class="option">['add', 'update', 'buildFile']</code> array are Mimosa workflows. mimosa-minify-html needs to be invoked to minify HTML when an HTML file is built (when Mimosa starts), added (after it starts), or updated (while it is running).</li>
              <li><code class="option">'beforeWrite'</code> indicates what workflow step to call the module's code. In this case right before a file is written its HTML needs to be minified.</li>
              <li><code class="option">_execute</code> is the function to invoke in order to perform the minification of the file being processed.</li>
              <li><code class="option">[ "html", "htm" ]</code> indicates the function should only be called for HTML based extensions.</li>
            </ul>
          </div>
          <div class="span4">
            <pre>register(
  [ "add", "update", "buildFile"],
  "afterCompile",
  _execute,
  [ "html", "htm" ]
);</pre>
          </div>
        </div>

        <p>Lets look at the first few lines of the <a href="https://github.com/dbashford/mimosa-minify-html/blob/3589ae3113286cdb7243107ba4c4a62dffa93db1/src/index.js#L6-L7">_execute</a> function.</p>

      <div class="row">
        <div class="span7">
          <p>Functions called during Mimosa's workflows are handed three objects.</p>

          <ul>
            <li>The resolved mimosa-config, including the configuration for the module being invoked.</li>
            <li>An <code class="option">options</code> object which contains the information regarding the current file(s) being processed.</li>
            <li>A <code class="option">next</code> callback which informs Mimosa it can continue on to the next step in the workflow.</li>
          </ul>
        </div>
        <div class="span5">
          <pre>var _execute = function ( mimosaConfig, options, next ) {
  if ( options.files && options.files.length ) {
    ...</pre>
        </div>
      </div>


      <p>The <code class="option">options</code> object contains a <code class="option">files</code> array which contains references to the file(s) being processed including their file path and file text. The code above does a check to see if there are any
        files to process. If there isn't, there is nothing to minify, so it calls the <code class="option">next</code> callback and exits.</p>

      <p>Finally, how does one pass information along? The mimosa-minify-html module doesn't write anything, it just <a href="https://github.com/dbashford/mimosa-minify-html/blob/3589ae3113286cdb7243107ba4c4a62dffa93db1/src/index.js#L14">minifies text</a> that is already available in the <code class="option">files</code>array and then stores the result on the file object itself. Other modules are responsible for writing the file objects once processing for the file has finished.</p>

      <p>Hopefully that is a simple starter to get you going building your own module.</p>

      <p>Exhaustive details follow.</p>

      <div class="page-header" id="details">
        <h1>
          Create Your Own Module: The Details
        </h1>
      </div>

      <h2>Where to start?</h2>

      <p>First, check out the <a href="http://dbashford.github.io/making-a-mimosa-module/index.html">blog post</a>, and if you still have questions, come back here for more details.</p>

      <p>By far the easiest way to create a new module is to start with an existing one.  There are many modules available on GitHub.  Pick one that does something somewhat similar to what you want to do and make tiny modifications to it.</p>

      <p>There are also module skeletons. <code class='option'>mimosa skel:new</code> can be used to pull in a skeleton. There are two available in the skeleton registry <code class='option'>mimosa-module-javascript</code> and <code class='option'>mimosa-module-coffeescript</code>. So, for instance, <code class='option'>mimosa skel:new mimosa-module-javascript</code> will pull in the JavaScript Mimosa module skeleton.

      <p>The only hard and fast rule with Mimosa modules is that when they are created they must be prefixed with 'mimosa-'. This makes them easy to find if someone else wants to use them, but also differentiates Mimosa's modules from all of the libraries both in <a href="https://npmjs.org/">NPM</a> and inside Mimosa. So you'll want to make sure that you keep the name of the module prefixed.</p>

      <h2>What does a skeleton give me?</h2>

      <p>The module skeletons provide a group of files to get module development started.</p>

          <ul>
            <li><code class='option'>package.json</code>: Those familiar with node.js recognize this file. This defines all sorts of metadata about a node project: the project name, dependencies, repo location, a description, and more. When a project is published to <a href="https://npmjs.org/">NPM</a>, NPM expects the <code class='option'>package.json</code> to be present. The <code class='option'>package.json</code> that Mimosa provides needs some editing. Many of the fields inside of it are placeholders and should be changed before publishing.</li>
            <li><code class='option'>index.js</code>/<code class='option'>index.coffee</code>: This highly commented file defines a module's interface to Mimosa. Mimosa will use this file to execute a module's functionality. How a module is structured is entirely up to the developer, as long as the functions Mimosa expects are exported in the <code class='option'>index</code> file.</li>
            <li><code class='option'>config.js</code>/<code class='option'>config.coffee</code>: This file is also highly commented and contains three functions that might need to be implemented: a function that returns the default configuration, a function that returns a string placeholder for the <code class='option'>mimosa-config</code>, and a function that validates a user's configuration for the module. Mimosa calls these functions at different times. If a module has no configuration at all, the functions and the file can be removed, or they can be left and commented out in case configuration might be introduced later.</li>
            <li>A <code class='option'>docs</code> folder: Using a tool called <a href="http://jashkenas.github.com/docco/">Docco</a> the comments in the <code class='option'>config</code> and <code class='option'>index</code> files have been turned into easy to read web pages, with comments alongside code. This is the real place to start. Read through the the Docco pages and get comfy with the concepts.</li>
            <li>A starter <code class='option'>README.md</code> with a few things filled out.</li>
          </ul>

          <h2>Mimosa module interface</h2>

          <p>At different times, Mimosa will attempt to execute five different functions in a module. All of the functions are optional.</p>

          <h3>registerCommand(program, retrieveConfig) or registerCommand(program, debug, retrieveConfig)</h3>

          <p>The <code class='option'>registerCommand</code> function is self-explanatory. This function is used to register new Mimosa commands.</p>

          <p>The arguments passed in are:</p>
          <ul>
            <li><code class='option'>program</code>: A <a href="https://github.com/visionmedia/commander.js/">commander</a>  <code class='option'>program</code> object. Use this object to register commands, help text, flags, and the command's callback.</li>
            <li><code class='option'>debug</code>: A boolean to indicate if Mimosa's debug mode should be turned on.</li>
            <li><code class='option'>retrieveConfig</code>: A callback function that a module can use to execute a Mimosa <code class='option'>clean</code> and <code class='option'>build</code> and get the full <code class='option'>mimosa-config</code> should it be needed. This function takes two parameters, a flag to indicate if a build should be run before executing the command, and a callback function to execute the command module's code. That callback is passed the full <code class='option'>mimosa-config</code>.</p>
      </ul>

      <p>The <a href="https://github.com/dbashford/mimosa-bower/blob/3df656086d84d8deee7cb244c3a7c0918d17cda3/src/index.coffee#L55-L78">mimosa-bower</a> module is a good example module for how to add a command to Mimosa. It adds three commands, <code class='option'>bower</code>, <code class='option'>bower:install</code> and
        <code
        class='option'>bower:clean</code>.</p>

      <h3>defaults()</h3>

      <div class="row">
        <div class="span6">
          <p>A module's <code class='option'>defaults</code> function is called when Mimosa starts up and is used to assemble the configuration used by Mimosa. <code class='option'>defaults</code> should return a JavaScript object that is the default configuration
            for the module. That default configuration is merged with the user provided configuration to establish the full <code class='option'>mimosa-config</code>.</p>

          <p>If a module doesn't have its own configuration, then this function does not need to be implemented.</p>
        </div>
        <div class="span6">
          <pre>exports.defaults = function() {
  return {
    minifyHtml: {
      options: {}
    }
  };
};</pre>
        </div>
      </div>

      <h3>placeholder()</h3>

      <div class="row">
        <div class="span6">
          <p>A module's <code class='option'>placeholder</code> function is called when Mimosa is building the <code class='option'>mimosa-config</code> file that is delivered to a user during both the <code class='option'>mimosa new</code> and <code class='option'>mimosa config</code> commands.
            Use this function to return a string that shows what the module's configuration is and then explains each setting.</p>
          <p>If a module doesn't have its own configuration, then this function does not need to be implemented.</p>

        </div>
        <div class="span6">
          <pre>exports.placeholder = function() {
  return "\t\n\n" +
  "  minifyHtml:     # config settings for HTML minifier\n" +
  "    options: {}   # pass-through options to the html-minifier tool";

};</pre>
        </div>
      </div>

      <h3>validate(mimosaConfig, validators)</h3>

      <div class="row">
        <div class="span6">
          <p>A module's <code class='option'>validate</code> function is called when Mimosa starts up and after Mimosa has put together the full <code class='option'>mimosa-config</code>. That full config is passed to the validate method of all modules and
            each module has the opportunity to ensure that the config settings are valid. This method should return an array of strings. Each string represents an error that the module has found with the config. If a module return any errors, Mimosa
            will print the errors and exit to give the user a chance to update the config.</p>

          <p>The <code class='option'>validate</code> function is also passed, as the second parameter, an object containing a collection of validation and utility functions. The best way to learn what those functions are is to <a href="https://github.com/dbashford/validatemimosa/blob/master/src/index.coffee">check the source</a>.

            <p>If there are no errors, return an empty array. If there is no config to validate, then do not implement the method.</p>

            <p>This method is also commonly where configuration manipulation and normalization takes place. For instance, this is a good place to turn relative paths into absolute ones so your module is dealing entirely with absolute paths in the config.</p>
        </div>
        <div class="span6">
          <pre>exports.validate = function( mimosaConfig, validators ) {
  var errs = []
    , mHtml = mimosaConfig.minifyHtml;

  if (validators.ifExistsIsObject(errs, "minifyHtml config", mHtml)) {
    validators.ifExistsIsObject(errs, "minifyHtml.options", mHtml.options);
  }

  return errs;
};</pre>
        </div>
      </div>

      <h3>registration(mimosaConfig, register)</h3>

      <div class="row">
        <div class="span6">
          <p>The <code class='option'>registration</code> function is the most important function of a module. This function is called during Mimosa's startup and it allows a module to bind to one or many steps in a Mimosa workflow. Inside this function
            is where a module tells Mimosa to call its functions at certain times.</p>

          <p>The arguments passed in are:</p>
          <ul>
            <li><code class='option'>mimosaConfig</code>: The full <code class='option'>mimosa-config</code> including added flags to indicate what sort of Mimosa command is being run (like isForceClean), and an added list of extensions being used by the application. A developer may decide based on the flags in the config to not register anything, which is fine. In the case of the minification example here, if the isMinify flag isn't turned on then the module doesn't register itself.</li>
            <li><code class='option'>register</code>: This is a function handed to a module as a means to register a module with Mimosa. More information about how to use this register function follows in the next section.</li>
          </ul>
        </div>
        <div class="span6">
          <pre>var registration = function ( mimosaConfig, register ) {
  if ( mimosaConfig.isMinify ) {
    register(
      [ "add", "update", "buildFile"],
      "afterCompile",
      _execute,
      [ "html", "htm" ]
    );
  }
};</pre>
        </div>
      </div>



      <div class="page-header" id="register">
        <h1>
          Registering A Workflow Module
          <small><span class="options">control when code gets called</span></small>
        </h1>
      </div>

      <p>As mentioned in a previous section, a module should implement a <code class='option'>registration</code> function that Mimosa calls when it starts up. When Mimosa calls the module's <code class='option'>registration</code> function, Mimosa passes the enriched <code class='option'>mimosa-config</code> and a <code class='option'>register</code> callback. The <code class='option'>register</code> callback is what a module uses to inform Mimosa what function in the module to call and under what circumstances to call it. The <code class='option'>register</code> function takes the following four parameters:</p>

      <ol>
        <li>A list of workflows, an array of strings. Pick one-to-many workflows depending on the sort of task the module accomplishes. The possible values, like buildFile, buildExtension, postBuild, add, update, and remove, are explained below.</li>
      <li>A workflow step, a string. A workflow step for the selected workflows. For example, for the 'update' workflow, a module's code might be executed 'afterCompile'. The list of steps for each workflow is explained below.</li>
      <li>Module callback, a function. This is the function Mimosa will call when processing reaches the workflow(s) and step called out in the previous parameters.</li>
      <li>An optional array of extensions upon which to execute the callback. If the file or extension being processed doesn't match one of these extensions, the callback will not be executed. The extensions refer to the original extension of the file being processed, so in the case of a CoffeeScript file it would be 'coffee' and not 'js'. The passed in <code class='option'>mimosaConfig</code> object has an <code class='option'>extensions</code> object a module can use to cover all of the desired extensions. The <code class='option'>extensions</code> object has 4 properties: <code class='option'>javascript</code>, <code class='option'>css</code>, <code class='option'>template</code>, and <code class='option'>copy</code>. If no extensions are provided, Mimosa will send all files/extensions through the module.</li>
      </ol>

      <pre>register(['add','update','buildFile'],      'afterCompile', _minifyJS, e.javascript);
register(['add','update','buildExtension'], 'beforeWrite',  _minifyJS, e.template);</pre>

      <p>Notice that the register method is executed multiple times. There is nothing stopping a module from registering multiple times for multiple workflows.</p>

      <h2>Workflows</h2>

      <p>A workflow is a set of steps an asset, a group of assets, or an application can go through. There are three groups of workflows: build, watch and clean.</p>

      <div class="row">
        <div class="span4">
          <h3>Build Workflows</h3>

          <p>Modules registered to take place during the build workflows perform project builds. The build workflows all occur in order during Mimosa's startup. <code class="options">preBuild</code> occurs first, followed by <code class="options">buildFile</code>, <code class="options">buildExtension</code>, and <code class="options">postBuild</code>.</p>

          <h4>preBuild</h4>
          <p><code class="options">preBuild</code> is processed before any asset is handled. This is the workflow for preparing the file system and moving files around in preparation for individual file processing.</p>

          <h4>buildFile</h4>
          <p>During <code class="options">buildFile</code> each file in the configured <code class="options">watch.sourceDir</code> is individually processed. This step is when, for instance, CoffeeScript files are compiled to JavaScript and written to <code class="options">watch.compiledDir</code>. It is also when images are copied to the <code class="options">watch.compiledDir</code>.</p>

          <p>Some assets, like micro-template files (Handlebars or Dust) and CSS preprocessor files (SASS or LESS) are not processed during this step as they, during startup, need to be dealt with as a group rather than individually.</p>

          <h4>buildExtension</h4>
          <p>After all of the assets are processed individually, <code class="options">buildExtension</code> makes another pass through all the assets, but this time to handle extension-wide processing. Now is when Mimosa handles the file types that need to be managed as a group like micro-templates and CSS preprocessors.</p>

          <p>For instance, if a project uses SASS, then it might have 20 includes/partials that result in two top-level files. Mimosa will process all 20 files at once and recognize that only two files need to be compiled.</p>

          <h4>postBuild</h4>

          <p>After the extensions are finished, individual asset handling is finished. <code class="options">postBuild</code> is when post asset completion tasks, like asset optimization, take place. <code class="options">postBuild</code> is also when servers are started. If a module was being built for something like installing the app to Heroku, then <code class="options">postBuild</code> is a candidate workflow.</p>
        </div>
        <div class="span4">
          <h3>Watch Workflows</h3>

          <p>If <code class="options">mimosa build</code> was executed, then after <code class="options">postBuild</code> is done, Mimosa exits. If <code class="options">mimosa watch</code> is executed, then Mimosa keeps running and monitors the project's codebase for changes. When changes occur, the watch workflows are executed. The watch types are very straight forward.</p>

          <p>For watch types no delineation exists between file and extension. For each type only a single file is processed at a time. So modules like the CSS and micro-templates compilers perform extension-wide tasks based on the single file that was updated.</p>

          <h4>add</h4>
          <p>The <code class="options">add</code> workflow is kicked off when a new file is added to the <code class="options">watch.sourceDir</code> directory.</p>

          <h4>update</h4>
          <p>The <code class="options">update</code> workflow is run when an existing file in the <code class="options">watch.sourceDir</code> directory is saved.</p>

          <h4>remove</h4>
          <p>The <code class="options">remove</code> workflow is executed when a file in the <code class="options">watch.sourceDir</code> directory is deleted.</p>
        </div>
        <div class="span4">

          <h3>Clean Workflows</h3>

          <p>The clean workflows execute when using <code class="options">mimosa clean</code> (but not currently when <code class="options">--force</code> is used), when the <code class="options">--clean</code> flag is used with <code class="options">mimosa watch</code> and at the beginning of a <code class="options">mimosa build</code>. These workflows are responsible for removing compiled, copied and created assets and to generally return a project to a pre-Mimosa state. The clean workflows are always executed together and in order.</p>

          <p>Modules can create and deposit files during the other workflows. A good module will use the clean workflows to tidy up after itself.</p>

          <h4>preClean</h4>
          <p>The <code class="options">preClean</code> workflow is executed first and is an opportunity to handle files before <code class="options">cleanFile</code> comes through and deals with each file individually.</p>

          <h4>cleanFile</h4>
          <p>Each file in the <code class="options">watch.sourceDir</code> is passed through the <code class="options">cleanFile</code> workflow one at a time.</p>

          <h4>postClean</h4>
          <p>The <code class="options">postClean</code> workflow is the final opportunity to tidy up files and directories. This is when, for example, a module might make a pass to remove any empty directories the module might be responsible for that remain after the files have been handled.</p>

        </div>
      </div>

      <h2>Workflow Steps <small><span class="options">a list of processing steps for each workflow</span></small></h2>

      <p>The previous section covered each of the workflows. Each workflow has many steps within it. An example is the best way to illustrate how steps relate to workflows.</p>

      <p>The simplest workflow is <code class="options">update</code>. If a CoffeeScript file is saved inside the <code class="options">watch.sourceDir</code> while Mimosa is running, here is what might happen:</p>

      <ol>
        <li>The first step executed is <code class="options">init</code>. During the <code class="options">init</code> step, Mimosa will generate some information about the asset to be used by future steps. For instance it will set a flag into the <code class="options">options</code> object (discussed in the next section) to indicate that the file is a JavaScript file, and it will set flags to indicate if the file is a vendor file or not.</li>
        <li>During a step named <code class="options">read</code> the modified CoffeeScript file is read in.</li>
        <li>The <code class="options">compile</code> step is next. Here the CoffeeScript gets compiled to JavaScript.</li>
        <li>Next is <code class="options">afterCompile</code>. Here the compiled JavaScript is linted to get feedback regarding code quality.</li>
        <li>If minification was selected, <code class="options">beforeWrite</code> is where the compiled JavaScript would be minified.</li>
        <li>During the <code class="options">write</code> step the compiled JavaScript is written to the <code class="options">watch.compiledDir</code></li>
        <li>The <code class="options">afterWrite</code> step is where optimization takes place if that is selected.</li>
      </ol>

      <p>Also, many modules can register to be executed for the same workflow and step, they'll just be executed in order that they get registered which is determined by their order in the <code class="options">modules</code> array in the <code class="options">mimosa-config</code>.</p>

      <p>When building a module, a developer needs to decide which step is the right place to execute a module's functionality. For instance, if building a module that will run <a href="http://www.coffeelint.org/">CoffeeLint</a> over CoffeeScript to determine CoffeeScript code quality, then <code class="options">afterRead</code> is probably the best step. If, for instance, <code class="options">beforeRead</code> is used, then Mimosa will have not yet read in the file, and there will be nothing on which to run CoffeeLint.</p>

      <h2>Workflow Type & Step Breakdown</h2>

      <div id="workflow-toggles" class="btn-group">
        <button data-type="build" class="btn span4 active">Build Workflows</button>
        <button data-type="watch" class="btn span4">Watch Workflows</button>
        <button data-type="clean" class="btn span4">Clean Workflows</button>
      </div>

      <br/>

      <div data-type="build" class="row workflow-steps">
        <div class="span3">
          <h3>preBuild</h3>
          <ul>
            <li>
              <div class="step">init</div>
            </li>
            <li>
              <div class="step">complete</div>
            </li>
          </ul>
        </div>

        <div class="span3">
          <h3>buildFile</h3>
          <ul>
            <li>
              <div class="step">init</div>
            </li>
            <li>
              <div class="step">beforeRead</div>
            </li>
            <li>
              <div class="step">read</div>
            </li>
            <li>
              <div class="step">afterRead</div>
            </li>
            <li>
              <div class="step">betweenReadCompile</div>
            </li>
            <li>
              <div class="step">beforeCompile</div>
            </li>
            <li>
              <div class="step">compile</div>
            </li>
            <li>
              <div class="step">afterCompile</div>
            </li>
            <li>
              <div class="step">betweenCompileWrite</div>
            </li>
            <li>
              <div class="step">beforeWrite</div>
            </li>
            <li>
              <div class="step">write</div>
            </li>
            <li>
              <div class="step">afterWrite</div>
            </li>
            <li>
              <div class="step">complete</div>
            </li>
          </ul>
        </div>
        <div class="span3">
          <h3>buildExtension</h3>
          <ul>
            <li>
              <div class="step">init</div>
            </li>
            <li>
              <div class="step">beforeRead</div>
            </li>
            <li>
              <div class="step">read</div>
            </li>
            <li>
              <div class="step">afterRead</div>
            </li>
            <li>
              <div class="step">betweenReadCompile</div>
            </li>
            <li>
              <div class="step">beforeCompile</div>
            </li>
            <li>
              <div class="step">compile</div>
            </li>
            <li>
              <div class="step">afterCompile</div>
            </li>
            <li>
              <div class="step">betweenCompileWrite</div>
            </li>
            <li>
              <div class="step">beforeWrite</div>
            </li>
            <li>
              <div class="step">write</div>
            </li>
            <li>
              <div class="step">afterWrite</div>
            </li>
            <li>
              <div class="step">complete</div>
            </li>
          </ul>
        </div>
        <div class="span3">
          <h3>postBuild</h3>
          <ul>
            <li>
              <div class="step">init</div>
            </li>
            <li>
              <div class="step">beforeOptimize</div>
            </li>
            <li>
              <div class="step">optimize</div>
            </li>
            <li>
              <div class="step">afterOptimize</div>
            </li>
            <li>
              <div class="step">beforeServer</div>
            </li>
            <li>
              <div class="step">server</div>
            </li>
            <li>
              <div class="step">afterServer</div>
            </li>
            <li>
              <div class="step">beforePackage</div>
            </li>
            <li>
              <div class="step">package</div>
            </li>
            <li>
              <div class="step">afterPackage</div>
            </li>
            <li>
              <div class="step">beforeInstall</div>
            </li>
            <li>
              <div class="step">install</div>
            </li>
            <li>
              <div class="step">afterInstall</div>
            </li>
            <li>
              <div class="step">complete</div>
            </li>
          </ul>
        </div>
      </div>

      <div data-type="watch" class="row workflow-steps hide">
        <div class="span4">
          <h3>add</h3>
          <ul>
            <li>
              <div class="step">init</div>
            </li>
            <li>
              <div class="step">beforeRead</div>
            </li>
            <li>
              <div class="step">read</div>
            </li>
            <li>
              <div class="step">afterRead</div>
            </li>
            <li>
              <div class="step">betweenReadCompile</div>
            </li>
            <li>
              <div class="step">beforeCompile</div>
            </li>
            <li>
              <div class="step">compile</div>
            </li>
            <li>
              <div class="step">afterCompile</div>
            </li>
            <li>
              <div class="step">betweenCompileWrite</div>
            </li>
            <li>
              <div class="step">beforeWrite</div>
            </li>
            <li>
              <div class="step">write</div>
            </li>
            <li>
              <div class="step">afterWrite</div>
            </li>
            <li>
              <div class="step">betweenWriteOptimize</div>
            </li>
            <li>
              <div class="step">beforeOptimize</div>
            </li>
            <li>
              <div class="step">optimize</div>
            </li>
            <li>
              <div class="step">afterOptimize</div>
            </li>
            <li>
              <div class="step">complete</div>
            </li>
          </ul>
        </div>
        <div class="span4">
          <h3>update</h3>
          <ul>
            <li>
              <div class="step">init</div>
            </li>
            <li>
              <div class="step">beforeRead</div>
            </li>
            <li>
              <div class="step">read</div>
            </li>
            <li>
              <div class="step">afterRead</div>
            </li>
            <li>
              <div class="step">betweenReadCompile</div>
            </li>
            <li>
              <div class="step">beforeCompile</div>
            </li>
            <li>
              <div class="step">compile</div>
            </li>
            <li>
              <div class="step">afterCompile</div>
            </li>
            <li>
              <div class="step">betweenCompileWrite</div>
            </li>
            <li>
              <div class="step">beforeWrite</div>
            </li>
            <li>
              <div class="step">write</div>
            </li>
            <li>
              <div class="step">afterWrite</div>
            </li>
            <li>
              <div class="step">betweenWriteOptimize</div>
            </li>
            <li>
              <div class="step">beforeOptimize</div>
            </li>
            <li>
              <div class="step">optimize</div>
            </li>
            <li>
              <div class="step">afterOptimize</div>
            </li>
            <li>
              <div class="step">complete</div>
            </li>
          </ul>
        </div>
        <div class="span4">
          <h3>remove</h3>
          <ul>
            <li>
              <div class="step">init</div>
            </li>
            <li>
              <div class="step">beforeRead</div>
            </li>
            <li>
              <div class="step">read</div>
            </li>
            <li>
              <div class="step">afterRead</div>
            </li>
            <li>
              <div class="step">beforeDelete</div>
            </li>
            <li>
              <div class="step">delete</div>
            </li>
            <li>
              <div class="step">afterDelete</div>
            </li>
            <li>
              <div class="step">beforeCompile</div>
            </li>
            <li>
              <div class="step">compile</div>
            </li>
            <li>
              <div class="step">afterCompile</div>
            </li>
            <li>
              <div class="step">betweenCompileWrite</div>
            </li>
            <li>
              <div class="step">beforeWrite</div>
            </li>
            <li>
              <div class="step">write</div>
            </li>
            <li>
              <div class="step">afterWrite</div>
            </li>
            <li>
              <div class="step">betweenWriteOptimize</div>
            </li>
            <li>
              <div class="step">beforeOptimize</div>
            </li>
            <li>
              <div class="step">optimize</div>
            </li>
            <li>
              <div class="step">afterOptimize</div>
            </li>
            <li>
              <div class="step">complete</div>
            </li>
          </ul>
        </div>
      </div>

      <div data-type="clean" class="row workflow-steps hide">
        <div class="span4">
          <h3>preClean</h3>
          <ul>
            <li>
              <div class="step">init</div>
            </li>
            <li>
              <div class="step">complete</div>
            </li>
          </ul>
        </div>

        <div class="span4">
          <h3>cleanFile</h3>
          <ul>
            <li>
              <div class="step">init</div>
            </li>
            <li>
              <div class="step">beforeRead</div>
            </li>
            <li>
              <div class="step">read</div>
            </li>
            <li>
              <div class="step">afterRead</div>
            </li>
            <li>
              <div class="step">beforeDelete</div>
            </li>
            <li>
              <div class="step">delete</div>
            </li>
            <li>
              <div class="step">afterDelete</div>
            </li>
            <li>
              <div class="step">complete</div>
            </li>
          </ul>
        </div>
        <div class="span4">
          <h3>postClean</h3>
          <ul>
            <li>
              <div class="step">init</div>
            </li>
            <li>
              <div class="step">complete</div>
            </li>
          </ul>
        </div>
      </div>



      <div class="page-header" id="callback">
        <h1>
          Your Workflow Module Callback
          <small><span class="options">when the rubber hits the code</span></small>
        </h1>
      </div>

      <p>So a module's code is registered to be called in the right spot in the workflow. What happens when Mimosa calls the function that has been registered?</p>

      <p>The executed function is handed three arguments.</p>

      <ol>
        <li><code class="options">config</code>: The full <code class="options">mimosa-config</code> enriched with all sorts of useful data beyond the default <code class="options">mimosa-config</code>, and including the configuration for the module being
          developed.</li>
        <li><code class="options">options</code>: An object containing information about the asset(s)/extension currently being processed. At different steps of the a Mimosa workflow the options object will contain various important pieces of information.
          One of the first steps a module developer should take when developing a new module is to <code class="options">console.log</code> the content of the options object to see what sort of information is available at their desired workflow and workflow step.</li>
        <li><code class="options">next</code>: a workflow callback. This callback must be called when a module has finished processing. It tells Mimosa to execute the next step in the workflow. If for some reason a module decides that processing for the current asset/build step needs to stop, the callback can be called passing false. Ex: <code class="options">next(false)</code>. In most cases the workflow should not be ended prematurely.</li>
      </ol>

      <div class="page-header" id="register">
        <h1>
          Registering A Command Module
          <small><span class="options">add brand new commands</span></small>
        </h1>
      </div>

      <p>A command module has a very simple interface. A module that intends to implement a new command needs to implement and export a <code class='option'>registerCommand</code> function. That function takes a <a href="https://github.com/visionmedia/commander.js/">commander</a>
        <code
        class='option'>program</code>object for registering the command, the flags, the help text and a callback.</p>

      <p>If a function needs access to execute a <code class='option'>build</code> before running, or needs the <code class='option'>mimosa-config</code>, it can get accomplish those things using the second parameter passed to <code class='option'>registerCommand</code>. The second parameter, a <code class='option'>retrieveConfig</code> function, takes a flag indicating if a build is needed, and a callback. That callback should contain the command module's code, and it is passed the full <code class='option'>mimosa-config</code>.</p>

      <div class="page-header" id="register">
        <h1>
          Logging
          <small><span class="options">access Mimosa's logging capabilities</span></small>
        </h1>
      </div>

      <p>Mimosa's logger, <a href="https://github.com/dbashford/logmimosa">logmimosa</a>, is attached to the resolved <code class='option'>mimosaConfig</code> when Mimosa starts up. Every function in a module that Mimosa calls and includes the <code class='option'>mimosaConfig</code>, like the workflow methods, <code class='option'>registration</code> or <code class='option'>registerCommand</code>, can access the logger via <code class='option'>mimosaConfig.log</code>.</p>

      <p>To take advantage of Mimosa's colorizing, wrap important or variable parts of log messages in <code class='option'>[[</code> and <code class='option'>]]</code>.</p>

      <div class="page-header" id="install">
        <h1>
          Installing A Module
          <small><span class="options">You've coded it up, now what?</span></small>
        </h1>
      </div>

      <h2>During Development</h2>

      <p>The <code class="options">mimosa mod:install</code> command handles installing local modules to Mimosa. From inside the root module directory, the directory with the <code class="options">package.json</code> file, execute <code class="options">mimosa mod:install</code>. Then modify the modules array of a project's <code class="options">mimosa-config</code> to use the module. Fire up Mimosa and test your module out!</p>

      <h2>Publishing to NPM</h2>

      <p>If you are familiar with <a href="http://npmjs.org/">NPM</a>, this part is not new. A simple <code class="options">npm publish</code> from the root of your module will install a module to NPM so that anyone can get access to it. Once it is in NPM, commands like <code class="options">mod:install</code> and <code class="options">mod:list</code> will be able to find it.</p>

      <p>If you have never published to NPM before, then spend a few minutes reading the <a href="https://npmjs.org/doc/developers.html">developer docs</a>. Just a few simple steps and you are ready to publish.</p>

      <p>With upcoming Mimosa releases, Mimosa will no longer recognize CoffeeScript modules. The CoffeeScript module skeleton delivered with <code class="options">mod:init -c</code> accounts for this by using Mimosa to build the CoffeeScript module when npm install and publish are used.</p>

      <p>If you do create and publish a module, let us know!!!</p>

    </section>
  </div>

  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
  <script>
    window.jQuery || document.write('<script src="js/vendor/jquery-1.7.2.min.js"><\/script>')
  </script>
  <script src="js/vendor/bootstrap-collapse.js"></script>
  <script src="js/vendor/bootstrap-scrollspy.js"></script>

  <!-- scripts concatenated and minified via build script -->
  <script src="js/plugins.js"></script>
  <script src="js/main.js"></script>
  <script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script>
  <!-- end scripts -->

  <script>
    var _gaq = [
      ['_setAccount', 'UA-33737130-1'],
      ['_trackPageview']
    ];
    (function(d, t) {
      var g = d.createElement(t),
        s = d.getElementsByTagName(t)[0];
      g.src = ('https:' == location.protocol ? '//ssl' : '//www') + '.google-analytics.com/ga.js';
      s.parentNode.insertBefore(g, s)
    }(document, 'script'));
  </script>

</body>

</html>
